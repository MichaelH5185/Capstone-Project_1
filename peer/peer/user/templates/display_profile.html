{% extends 'template.html' %}

{% block title %}
<title>PeerSkill | {{ u.username }}'s Profile</title>
{% endblock %}

{% block content %}
<div class="main">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1>{{ u.username }}'s Profile</h1>
        {% if u.username == request.user.username %}
            <a href="{% url 'user:update_profile' %}" class="btn">Edit Profile</a>
        {% endif %}
    </div>
</div>
<div class="main">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; max-width:75%;">
        <strong id="rev-trigger">Reviews</strong>
        <strong id="board-trigger">Boards</strong>
        <strong id="list-trigger">Listings</strong>
    </div>
</div>
<section class="profile-details">
    <div class="profile-main">
        <div id="review-content" style="display:none;">
            <h2>Recent Reviews</h2>
            <hr>
            {% if reviews %}
                {% for r in reviews %}
                    <div class="review-card" style="border-left: 3px solid #007bff; padding-left: 1rem; margin-bottom: 1rem;">
                        <p><strong>{{ r.author.username }}</strong> - {{ r.time_created|date:"M d, Y" }}</p>
                        <p>Rating: {{ r.rating }}/5.0</p>
                        <p>{{ r.message }}</p>
                        <hr>
                    </div>
                {% endfor %}
            {% else %}
                <p>No reviews yet.</p>
            {% endif %}
        </div>
        <div id="board-content"  style="display:none;">
            <h2>Boards Participated In</h2>
            <hr>
            {% if boards %}
                {% for b in boards %}
                    <div class="review-card" style="border-left: 3px solid #007bff; padding-left: 1rem; margin-bottom: 1rem;">
                        <a href="{% url 'board:display_board' b.id %}">{{b.title}}</a>
                        <p>{{b.description}}</p>
                        <p>Skill: {{b.skill.name}} Created: {{b.created}} Creator: {{b.creator}}</p>
                        <hr>
                    </div>
                {% endfor %}
            {% else %}
                <p>User not in any boards yet.</p>
            {% endif %}
        </div>
        <div id="listing-content" style="display:none;">
            <h2>User Listings</h2>
            <hr>
            {% if listings %}
                <div class="cards">
                {% for l in listings %}
                    <article class="card listing-card">
                        <h3 class="listing-title">{{ l.title }}</h3>
                        <p class="listing-desc">{{ l.description|default:"(no description)" }}</p>
                        <div class="listing-meta">
                            <span class="author">{{ l.author.username|default:'Anon' }}</span>
                            {% if l.price %}<span class="price">${{ l.price }}</span>{% endif %}
                        </div>
                        <div class="card-actions">
                            <a class="btn small" href="{% url 'peer:send_message' l.id %}">Message</a>
                            {% if request.user.is_authenticated and request.user == l.author %}
                                <a class="btn small danger" href="{% url 'peer:delete_listing' l.id %}">Delete</a>
                            {% endif %}
                        </div>
                    </article>
                {% endfor %}
            </div>
            {% else %}
                <p>User has no listings.</p>
            {% endif %}
        </div>
    </div>
    <div class="profile-card">
        <div class="profile-section">
            <h3>Name</h3>
            <p>{{ u.first_name }} {{ u.last_name }}</p>
        </div>

        <div class="profile-section">
            <h3>About Me</h3>
            <p>{{ p.about|default:"No bio provided yet." }}</p>
        </div>

        <div class="profile-section">
            <h3>Location</h3>
            <p>{{ p.town }}, {{ p.state }} {{ p.zipcode }}</p>
        </div>

        <div class="profile-section">
            <h3>My Skills</h3>
            {% if u.skills.exists %}
                <ul style="list-style: none; padding: 0;">
                    {% for skill in u.skills.all %}
                        <li style="display: inline-block; background: #007bff; color: white; padding: 0.3rem 0.6rem; margin: 0.2rem; border-radius: 4px;">
                            {{ skill.name }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No skills added yet.</p>
            {% endif %}
        </div>

        <div class="profile-section">
            <h3>My Rating</h3>
            <p>{{ u.rating }}/5.0 stars from {{ u.rating_count }} review{{ u.rating_count|pluralize }}</p>
        </div>
        {% if u.username != request.user.username %}
            <div style="margin-top: 1.5rem;">
                <a href="{% url 'user:leave_review' u.id %}" class="btn">Leave a Review</a>
            </div>
        {% endif %}
    </div>
    
</section>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const revTrigger = document.getElementById("rev-trigger");
    const revDiv = document.getElementById("review-content");
    const boardTrigger = document.getElementById("board-trigger");
    const boardDiv = document.getElementById("board-content");
    const listTrigger = document.getElementById("list-trigger");
    const listDiv = document.getElementById("listing-content");
    function showReviews(){
        revDiv.style.display = "block";
        revTrigger.style.textDecoration = "underline";
        boardDiv.style.display = "none";
        boardTrigger.style.textDecoration = "none";
        listDiv.style.display = "none";
        listTrigger.style.textDecoration = "none";
    }
    function showBoards(){
        revDiv.style.display = "none";
        revTrigger.style.textDecoration = "none";
        boardDiv.style.display = "block";
        boardTrigger.style.textDecoration = "underline";
        listDiv.style.display = "none";
        listTrigger.style.textDecoration = "none";
    }
    function showLists(){
        revDiv.style.display = "none";
        revTrigger.style.textDecoration = "none";
        boardDiv.style.display = "none";
        boardTrigger.style.textDecoration = "none";
        listDiv.style.display = "block";
        listTrigger.style.textDecoration = "underline";
    }
    showReviews()
    revTrigger.addEventListener("click", showReviews);
    boardTrigger.addEventListener("click", showBoards);
    listTrigger.addEventListener("click", showLists);
});
</script>
{% endblock %}